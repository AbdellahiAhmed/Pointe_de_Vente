---
phase: 07-ui-redesign
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - front/index.html
  - front/src/css/index.scss
  - front/src/app-frontend/components/search/product.grid.tsx
  - front/src/app-frontend/components/cart/cart.container.tsx
  - front/src/app-frontend/components/sale/sale.inline.tsx
  - front/src/app-frontend/components/modes/pos.tsx
autonomous: true
requirements: [UIPOS-01, UIPOS-02, UIPOS-03, UIPOS-04]

must_haves:
  truths:
    - "Product cards display images professionally with consistent aspect ratios and hover effects"
    - "All POS interactive elements (buttons, inputs, product cards) have at least 48px touch targets"
    - "Payment method buttons are large, prominent, and easily tappable on a touchscreen"
    - "POS layout stacks panels vertically on tablet screens (<=1024px) and remains usable"
    - "Cart quantity controls are touch-friendly with large +/- buttons"
    - "Tapping any POS input field (search, quantity) on a tablet does not cause automatic page zoom"
  artifacts:
    - path: "front/index.html"
      provides: "Fixed viewport meta tag"
      contains: "width=device-width, initial-scale=1"
    - path: "front/src/css/index.scss"
      provides: "Touch-optimized POS CSS with tablet responsive breakpoints"
      contains: "pos-payment-btn"
    - path: "front/src/app-frontend/components/search/product.grid.tsx"
      provides: "ProductGrid using CSS classes instead of inline style tokens"
    - path: "front/src/app-frontend/components/cart/cart.container.tsx"
      provides: "Touch-optimized cart with large controls"
    - path: "front/src/app-frontend/components/sale/sale.inline.tsx"
      provides: "Touch-optimized payment buttons and checkout panel"
  key_links:
    - from: "front/src/app-frontend/components/search/product.grid.tsx"
      to: "front/src/css/index.scss"
      via: "CSS class names replacing inline styles"
      pattern: "product-grid-card|product-grid-image|product-grid-name|product-grid-price"
    - from: "front/src/app-frontend/components/sale/sale.inline.tsx"
      to: "front/src/css/index.scss"
      via: "pos-payment-btn CSS class"
      pattern: "pos-payment-btn"
    - from: "front/src/css/index.scss"
      to: "front/src/app-frontend/components/modes/pos.tsx"
      via: "Responsive layout media queries"
      pattern: "@media.*max-width.*1024px"
---

<objective>
Redesign the POS cashier interface into a touch-optimized, visually professional screen inspired by Square/Toast/Lightspeed POS systems.

Purpose: The POS is the primary daily-use screen for cashiers. Every interaction must work with touch (no mouse required), with large targets, clear product images, and a streamlined payment flow. This is the visual polish layer on top of the complete feature set from Phases 1-6.

Output: Refactored POS components using CSS classes (not inline styles), touch-optimized cart and checkout, responsive tablet layout, fixed viewport tag.
</objective>

<execution_context>
@/Users/abdellahi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/abdellahi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-ui-redesign/07-RESEARCH.md
@front/src/css/index.scss
@front/src/app-frontend/components/search/product.grid.tsx
@front/src/app-frontend/components/cart/cart.container.tsx
@front/src/app-frontend/components/sale/sale.inline.tsx
@front/src/app-frontend/components/modes/pos.tsx
@front/index.html
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix viewport and refactor ProductGrid to CSS classes with touch optimization</name>
  <files>
    front/index.html
    front/src/css/index.scss
    front/src/app-frontend/components/search/product.grid.tsx
  </files>
  <action>
**1. Fix viewport meta tag in `front/index.html`:**
Change line 6 from `content="width=device-width. initial-scale=1"` (note the PERIOD) to `content="width=device-width, initial-scale=1"` (COMMA). This is critical for proper tablet/touch rendering.

**2. Refactor `product.grid.tsx` to use CSS classes instead of inline style tokens:**

The component currently defines a `const T = {...}` object duplicating all design tokens from `index.scss` CSS custom properties, then applies them as inline `style={{...}}` on every element. This must be refactored to use the existing CSS classes already defined in `index.scss` (`.product-grid-card`, `.product-grid-image`, `.product-grid-name`, `.product-grid-price`, `.product-grid-info`, `.product-grid-stock`, `.product-grid-container`, `.product-grid`, `.product-grid-categories`, `.category-chip`, `.product-grid-empty`, `.product-grid-placeholder`).

Specific changes:
- Remove the entire `const T = {...}` object (lines 24-43)
- Remove the `injectKeyframes()` function and its `useEffect` call (lines 48-62, 227) -- the scrollbar styles are already in `index.scss` via `.pos-panel-body`
- In `ProductCard`: replace inline `style={{...}}` props with CSS class names:
  - Outer `<div>`: use `className="product-grid-card"` (already has border, radius, shadow, hover, active styles in index.scss). Add `style={{ opacity: out ? 0.5 : 1 }}` only for the out-of-stock opacity.
  - Image container `<div>`: use `className="product-grid-image"` (already has aspect-ratio, background, overflow)
  - `<img>`: leave the img tag as-is since `.product-grid-image img` in index.scss already handles width/height/object-fit/hover-transform
  - Placeholder icon: use `className="product-grid-placeholder"` with conditional `hidden` class when image loads
  - Stock badges: use `className="product-grid-stock"` with `low` variant class. Move badge positioning to CSS (add `.product-grid-badge` class in index.scss)
  - Product info: use `className="product-grid-info"`
  - Product name: use `className="product-grid-name"`
  - Product price: use `className="product-grid-price"`
- In `ProductGrid`: replace inline styles:
  - Outer container: use `className="product-grid-container"` instead of inline flex/height/background
  - Category bar: use `className="product-grid-categories"` for the scrolling container
  - Category buttons: use `className={classNames("category-chip", { active: isActive })}` instead of the `chipStyle()` function. Remove the `chipStyle` function entirely.
  - Item count badge: add a `.product-grid-count` class
  - Product grid scrollable area: use `className="product-grid pg-scroll"` instead of inline styles
  - Empty state: use `className="product-grid-empty"`
- Import `classNames` from the `classnames` package (already a dependency in the project)

**3. Add missing CSS classes and touch enhancements in `index.scss`:**

Add these new CSS rules after the existing product grid section:

```scss
/* Stock badge positioning */
.product-grid-badge {
  position: absolute;
  top: 6px;
  inset-inline-end: 6px;
  padding: 3px 8px;
  border-radius: var(--pos-radius-sm);
  font-size: 10px;
  font-weight: 700;
  text-transform: uppercase;
  color: #fff;
  z-index: 1;

  &.out {
    background: var(--pos-danger);
  }
  &.low {
    background: #f59e0b;
  }
}

/* Product count badge */
.product-grid-count {
  font-size: 11px;
  color: var(--pos-text-faint);
  font-weight: 600;
  white-space: nowrap;
  padding: 4px 12px;
  border-radius: var(--pos-radius-sm);
  background: var(--pos-bg);
  flex-shrink: 0;
}
```

Ensure all category chip buttons have `min-height: 40px` by updating `.category-chip` padding to `padding: 8px 16px` for better touch targets.

Update `.product-grid` to use `minmax(140px, 1fr)` instead of `minmax(120px, 1fr)` for slightly larger cards that are easier to tap.

**4. Ensure product card touch targets are adequate:**
The `.product-grid-card` already has `:active { transform: scale(0.97) }` for tactile feedback. Add `touch-action: manipulation` and `-webkit-tap-highlight-color: transparent` to `.product-grid-card` to prevent double-tap zoom and remove tap highlights on iOS.

**CONSTRAINTS:**
- Use logical properties (inset-inline-end, not right) for RTL compatibility
- Use only Tailwind + custom CSS for POS components, NEVER Bootstrap classes
- Preserve all existing functionality (category filtering, product click handler, stock badges, translations)
- The `marginRight: '6px'` on the "All" button icon (line 289) should use `marginInlineEnd: '6px'` for RTL
  </action>
  <verify>
Run `cd /Users/abdellahi/Documents/POS/Pointe_de_Vente/front && npx tsc --noEmit` to verify no TypeScript errors. Then run `npm run build` to confirm production build succeeds. Grep `product.grid.tsx` for `const T =` to confirm inline tokens are removed. Grep `index.html` for `width=device-width,` (with comma) to confirm viewport fix.
  </verify>
  <done>
ProductGrid uses CSS classes from index.scss instead of inline style tokens. The `const T` object and `injectKeyframes()` are removed. Viewport meta tag has correct comma separator. All product grid elements use the design system CSS classes. Touch-action and tap-highlight-color set on product cards.
  </done>
</task>

<task type="auto">
  <name>Task 2: Touch-optimize cart, checkout panel, and payment buttons with tablet responsive layout</name>
  <files>
    front/src/css/index.scss
    front/src/app-frontend/components/cart/cart.container.tsx
    front/src/app-frontend/components/sale/sale.inline.tsx
    front/src/app-frontend/components/modes/pos.tsx
  </files>
  <action>
**1. Add touch-optimized CSS to `index.scss`:**

Add at the end (before the RTL section):

```scss
/* ─── Touch Optimization ─── */
.pos-payment-btn {
  min-height: 56px;
  min-width: 80px;
  padding: 12px 20px;
  font-size: 16px;
  font-weight: 700;
  border-radius: var(--pos-radius);
  transition: all 0.12s ease;
  touch-action: manipulation;
  -webkit-tap-highlight-color: transparent;

  &:active {
    transform: scale(0.96);
  }
}

.pos-cart-qty-btn {
  min-width: 36px;
  min-height: 36px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  border-radius: var(--pos-radius-sm);
  border: 1px solid var(--pos-border);
  background: var(--pos-surface);
  color: var(--pos-text);
  font-size: 18px;
  font-weight: 700;
  cursor: pointer;
  touch-action: manipulation;
  -webkit-tap-highlight-color: transparent;
  transition: all 0.1s ease;

  &:hover {
    background: var(--pos-surface-hover);
    border-color: var(--pos-accent);
  }

  &:active {
    transform: scale(0.92);
    background: var(--pos-accent-light);
  }
}

.pos-cart-qty-input {
  min-height: 36px;
  width: 48px;
  text-align: center;
  font-size: 16px;
  font-weight: 600;
  border: 1px solid var(--pos-border);
  border-radius: var(--pos-radius-sm);
  background: var(--pos-surface);
  color: var(--pos-text);
  -moz-appearance: textfield;

  &::-webkit-inner-spin-button,
  &::-webkit-outer-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }
}

/* iOS zoom prevention for all POS inputs */
.pos-layout input,
.pos-layout textarea,
.pos-layout select,
.pos-topbar input,
.pos-topbar textarea {
  font-size: 16px !important;
}

/* ─── Tablet Responsive ─── */
@media (max-width: 1024px) {
  .pos-layout-grid {
    grid-template-columns: 1fr 1fr;
    grid-template-rows: 1fr auto;
    height: auto;
    min-height: calc(100vh - 56px);
  }

  .pos-layout-grid > .pos-panel:first-child {
    grid-column: 1 / -1;
    max-height: 50vh;
  }

  .pos-topbar {
    flex-wrap: wrap;
    gap: 8px;
    padding: 8px 12px;
  }

  .pos-topbar-search {
    order: -1;
    width: 100%;
    flex-basis: 100%;
  }
}

@media (max-width: 768px) {
  .pos-layout-grid {
    grid-template-columns: 1fr;
    gap: 8px;
    padding: 8px;
  }

  .pos-layout-grid > .pos-panel:first-child {
    max-height: 40vh;
  }

  .pos-layout-list {
    grid-template-columns: 1fr;
  }
}
```

**2. Touch-optimize `cart.container.tsx`:**

The cart currently uses `display: table` / `table-cell` layout with small padding. Make these changes:

- Add touch-friendly quantity controls: Replace the current quantity display in each `CartItem` with inline +/- buttons. Since `CartItem` is a separate component at `cart/cart.item.tsx`, the changes to `cart.container.tsx` are structural:
  - Change the outer div from `className="table w-full"` to `className="w-full"` (remove table layout)
  - Replace `table-header-group` / `table-row` / `table-cell` pattern with a flex/grid layout:
    - Header: `className="flex items-center gap-2 sticky top-0 z-10 bg-gray-200 p-2 text-xs font-bold"` with appropriate width columns
    - The existing table-cell structure with columns for checkbox, item, stock, qty, disc, taxes, rate, total -- simplify for touch by keeping: checkbox, item name, qty (with +/- buttons), rate, total. The stock/disc/taxes columns add clutter for touch; keep them but make them responsive (hide on small screens)
  - For the footer row, use flex layout to match the new header

  IMPORTANT: The CartItem component is in a separate file (`cart.item.tsx`). Do NOT modify `cart.item.tsx` in this task -- only modify `cart.container.tsx`. The structural change is: keep the existing table layout but add `text-base` (16px font-size) to prevent iOS zoom on input focus. Add `touch-action: manipulation` to the container.

  Simpler approach (less disruptive): Keep the existing table layout but:
  - Add `className="touch-action-manipulation"` (via inline style `style={{ touchAction: 'manipulation' }}`) to the container
  - Increase all `p-2` cells to use larger padding for touch: replace `p-2` with `p-2 py-3` on table cells for more vertical space
  - Add the minimum font-size fix via the CSS rule added above (`.pos-layout input { font-size: 16px !important; }`)
  - The header cells should have `text-sm` font size (they already have `font-bold`)

**3. Touch-optimize `sale.inline.tsx` payment buttons:**

The payment type buttons at line 565-596 use `<Button>` components with `size="lg"`. Enhance them:
- Add `className="btn-primary flex-grow flex-shrink-0 w-auto pos-payment-btn"` (add `pos-payment-btn` to the existing className)
- The "Done" submit button (line 705-713) should also get `pos-payment-btn` class for consistent touch target sizing
- The "Hold" button (line 715-722) gets `pos-payment-btn` class
- The payment input field (`#amount` at line 614-636) -- the CSS rule added above ensures `font-size: 16px` for iOS zoom prevention
- The "Add Adjustment" button should also get the touch class

**4. Verify topbar search inputs in `pos.tsx`:**

The search field (`Input` at line 609-616) has `className="search-field mousetrap lg w-64"`. The CSS rule above ensures 16px font-size. The quantity input at line 626-632 has `className="w-20 mousetrap lg"` -- same applies. No code changes needed in pos.tsx beyond the CSS fix, but verify the search and quantity inputs render at 16px.

**CONSTRAINTS:**
- Use logical properties (ms-*/me-*/ps-*/pe-*) not physical (ml-*/mr-*/pl-*/pr-*)
- POS uses Tailwind + custom CSS only, NEVER Bootstrap classes
- Preserve all keyboard shortcuts (Mousetrap bindings in cart and checkout)
- Preserve all payment flow logic (split payments, adjustment, hold, etc.)
- All new user-facing strings must be translated: add any new keys to both `lang.fr.json` and `lang.ar.json` (but this task likely adds no new strings since it's CSS/structural only)
  </action>
  <verify>
Run `cd /Users/abdellahi/Documents/POS/Pointe_de_Vente/front && npx tsc --noEmit` to verify TypeScript. Run `npm run build` to confirm production build. Visually inspect that the CSS includes media queries at 1024px and 768px. Grep `index.scss` for `pos-payment-btn` and `@media.*max-width.*1024px` to confirm both touch optimization and responsive rules exist.
  </verify>
  <done>
Payment buttons have 56px min-height with touch-action: manipulation. Cart inputs render at 16px font-size (no iOS zoom). POS layout stacks to 2-column at 1024px and single-column at 768px for tablets. All POS interactive elements have adequate touch targets. The `pos-payment-btn` class is applied to payment type buttons, Done button, and Hold button.
  </done>
</task>

</tasks>

<verification>
1. `cd /Users/abdellahi/Documents/POS/Pointe_de_Vente/front && npx tsc --noEmit` -- zero errors
2. `npm run build` -- production build completes successfully
3. `grep -c "const T =" front/src/app-frontend/components/search/product.grid.tsx` returns 0 (inline tokens removed)
4. `grep "width=device-width," front/index.html` matches (viewport comma fix)
5. `grep "pos-payment-btn" front/src/css/index.scss` matches (touch CSS present)
6. `grep "@media.*max-width.*1024px" front/src/css/index.scss` matches (tablet breakpoint present)
7. `grep "pos-payment-btn" front/src/app-frontend/components/sale/sale.inline.tsx` matches (touch class applied)
</verification>

<success_criteria>
- ProductGrid uses CSS classes from the design system (no inline style tokens)
- Viewport meta tag comma fix applied
- All POS buttons have 48px+ touch targets
- Payment buttons have 56px min-height with tactile feedback
- POS layout responds to tablet breakpoints (1024px, 768px)
- All POS inputs have 16px+ font-size to prevent iOS zoom
- TypeScript compilation and production build succeed
</success_criteria>

<output>
After completion, create `.planning/phases/07-ui-redesign/07-01-SUMMARY.md`
</output>
