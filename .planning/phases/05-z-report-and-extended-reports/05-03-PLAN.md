---
phase: 05-z-report-and-extended-reports
plan: 03
type: execute
wave: 2
depends_on:
  - 05-01
  - 05-02
files_modified:
  - front/package.json
  - front/src/assets/fonts/NotoSansArabic-Regular.ttf
  - front/src/assets/fonts/NotoSansArabic-Bold.ttf
  - front/src/app-admin/containers/closing/ZReportDocument.tsx
  - front/src/app-admin/containers/closing/z-report-page.tsx
  - front/src/app-admin/containers/reports/vendor-report.tsx
  - front/src/app-admin/containers/reports/category-report.tsx
  - front/src/app-admin/containers/reports/daily-report.tsx
  - front/src/app-admin/containers/reports/profit-report.tsx
  - front/src/app-frontend/components/sale/sale.closing.tsx
  - front/src/api/routing/routes/backend.app.ts
  - front/src/app-admin/routes/frontend.routes.ts
  - front/src/app-admin/app.tsx
  - front/src/app-admin/containers/layout/sidebar.tsx
autonomous: true
requirements:
  - ZRPT-05
  - ZRPT-07
  - RAPT-01
  - RAPT-02
  - RAPT-03
  - RAPT-04
  - RAPT-05

must_haves:
  truths:
    - "Z-Report PDF can be downloaded in French with all required sections rendered"
    - "Z-Report PDF can be downloaded in Arabic with RTL layout and Arabic font"
    - "The POS closing modal includes denomination count inputs for MRU bills (500, 200, 100, 50, 20, 10, 5, 1)"
    - "The admin Z-Report list page shows closed sessions with download buttons for FR and AR PDFs"
    - "Vendor report page displays per-vendeur performance data from /admin/report/vendor"
    - "Category report page displays per-category sales and profit data from /admin/report/category"
    - "Daily report page now shows top vendors and J-1 comparison"
    - "Profit report page now shows margin % per product"
  artifacts:
    - path: "front/src/app-admin/containers/closing/ZReportDocument.tsx"
      provides: "@react-pdf/renderer Document component for Z-Report"
      contains: "ZReportDocument"
    - path: "front/src/app-admin/containers/closing/z-report-page.tsx"
      provides: "Admin page listing closed sessions with PDF download"
      contains: "ZReportPage"
    - path: "front/src/app-admin/containers/reports/vendor-report.tsx"
      provides: "Vendor analytics report page"
      contains: "VendorReport"
    - path: "front/src/app-admin/containers/reports/category-report.tsx"
      provides: "Category analytics report page"
      contains: "CategoryReport"
  key_links:
    - from: "front/src/app-admin/containers/closing/ZReportDocument.tsx"
      to: "@react-pdf/renderer"
      via: "import { Document, Page, Text, View, Font }"
      pattern: "@react-pdf/renderer"
    - from: "front/src/app-admin/containers/closing/z-report-page.tsx"
      to: "/admin/closing/{id}/z-report-data"
      via: "fetch snapshot JSON"
      pattern: "z-report-data"
    - from: "front/src/app-admin/containers/reports/vendor-report.tsx"
      to: "/admin/report/vendor"
      via: "jsonRequest"
      pattern: "REPORT_VENDOR"
    - from: "front/src/app-frontend/components/sale/sale.closing.tsx"
      to: "/admin/closing/{id}/close"
      via: "POST on close day"
      pattern: "CLOSING_CLOSE"
---

<objective>
Build the complete frontend for the Z-Report system and extended analytics reports: install @react-pdf/renderer with Arabic font support, create the bilingual ZReportDocument PDF component, build the Z-Report list/download page, add denomination inputs to the POS closing modal, create vendor and category report pages, and enhance daily and profit report pages with the new backend data.

Purpose: This is the user-facing layer that turns the backend data into printable Z-Report PDFs and visual analytics dashboards, completing the Phase 5 deliverable.

Output: Z-Report PDF downloadable in FR and AR, denomination counting in POS, four report pages (vendor, category, enhanced daily, enhanced profit), all routed and sidebar-linked.
</objective>

<execution_context>
@/Users/abdellahi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/abdellahi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-z-report-and-extended-reports/05-RESEARCH.md
@.planning/phases/05-z-report-and-extended-reports/05-01-SUMMARY.md
@.planning/phases/05-z-report-and-extended-reports/05-02-SUMMARY.md

@front/package.json
@front/src/app-admin/app.tsx
@front/src/app-admin/routes/frontend.routes.ts
@front/src/api/routing/routes/backend.app.ts
@front/src/app-admin/containers/layout/sidebar.tsx
@front/src/app-admin/containers/reports/sales-report.tsx
@front/src/app-admin/containers/reports/profit-report.tsx
@front/src/app-admin/containers/reports/daily-report.tsx
@front/src/app-frontend/components/sale/sale.closing.tsx
@front/src/api/model/closing.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install @react-pdf/renderer, Arabic font, smoke test, and ZReportDocument + Z-Report page + denomination inputs</name>
  <files>
    front/package.json
    front/src/assets/fonts/NotoSansArabic-Regular.ttf
    front/src/assets/fonts/NotoSansArabic-Bold.ttf
    front/src/app-admin/containers/closing/ZReportDocument.tsx
    front/src/app-admin/containers/closing/z-report-page.tsx
    front/src/app-frontend/components/sale/sale.closing.tsx
    front/src/api/model/closing.ts
    front/src/api/routing/routes/backend.app.ts
    front/src/app-admin/routes/frontend.routes.ts
    front/src/app-admin/app.tsx
    front/src/app-admin/containers/layout/sidebar.tsx
  </files>
  <action>
    **A. Install @react-pdf/renderer and download Arabic fonts:**

    1. From the `front/` directory, run: `npm install @react-pdf/renderer@4.3.2`
    2. Create directory `front/src/assets/fonts/`.
    3. Download Noto Sans Arabic static TTF files. Get them from Google Fonts GitHub releases or the google-fonts npm package. The files must be `.ttf` format (NOT .woff2, NOT variable font). Place:
       - `front/src/assets/fonts/NotoSansArabic-Regular.ttf`
       - `front/src/assets/fonts/NotoSansArabic-Bold.ttf`
       If direct download URLs fail, use the Google Fonts API: search for "Noto Sans Arabic" static TTFs. An alternative source: `https://github.com/google/fonts/raw/main/ofl/notosansarabic/NotoSansArabic%5Bwdth%2Cwght%5D.ttf` — but this is variable. Instead use the static builds from the ZIP download or from `fonts.google.com` "Download family" button.

    **B. Arabic smoke-test (CRITICAL - do this BEFORE building ZReportDocument):**

    Create a temporary test file (or inline in ZReportDocument.tsx before the full implementation) that:
    ```tsx
    import { Document, Page, Text, Font, pdf } from '@react-pdf/renderer';
    import NotoSansArabicRegular from '../../assets/fonts/NotoSansArabic-Regular.ttf';

    Font.register({
      family: 'NotoSansArabic',
      fonts: [
        { src: NotoSansArabicRegular, fontWeight: 400 },
      ],
    });

    const SmokeTest = () => (
      <Document>
        <Page size="A4">
          <Text style={{ fontFamily: 'NotoSansArabic', direction: 'rtl', textAlign: 'right', fontSize: 14 }}>
            {'\u202B'}تقرير اليوم
          </Text>
        </Page>
      </Document>
    );
    ```
    Verify this compiles. If @react-pdf/renderer 4.3.2 fails with Arabic font errors, try pinning to `@react-pdf/renderer@3.3.5` instead.

    **C. Build ZReportDocument.tsx:**

    Create `front/src/app-admin/containers/closing/ZReportDocument.tsx`:

    This is a @react-pdf/renderer Document component that receives two props:
    - `data`: The Z-Report snapshot JSON (shape matching the backend snapshot from plan 05-01)
    - `lang`: `'fr' | 'ar'`

    Register fonts at module level:
    ```tsx
    Font.register({
      family: 'NotoSansArabic',
      fonts: [
        { src: NotoSansArabicRegular, fontWeight: 400 },
        { src: NotoSansArabicBold, fontWeight: 700 },
      ],
    });
    ```

    Create a `StyleSheet.create()` with:
    - `page`: padding 30, fontSize 10, fontFamily 'Helvetica'
    - `arabicPage`: same but fontFamily 'NotoSansArabic', direction 'rtl'
    - `header`: textAlign 'center', fontSize 16, marginBottom 10, fontWeight 'bold'
    - `sectionTitle`: fontSize 12, fontWeight 'bold', marginTop 15, marginBottom 5, borderBottom 1, paddingBottom 3
    - `row`: flexDirection 'row', justifyContent 'space-between', paddingVertical 2
    - `tableHeader`: flexDirection 'row', borderBottom 1, paddingBottom 3, fontWeight 'bold'
    - `tableRow`: flexDirection 'row', paddingVertical 2, borderBottom 0.5, borderColor '#ccc'
    - `col`: flex 1
    - `colRight`: flex 1, textAlign 'right'
    - `signatureBlock`: marginTop 40, borderTop 1, paddingTop 10
    - `arabicText`: fontFamily 'NotoSansArabic', direction 'rtl', textAlign 'right'
    - `footer`: position 'absolute', bottom 30, left 30, right 30, textAlign 'center', fontSize 8, color '#666'

    Helper: `const rtl = (text: string) => '\u202B' + text;` (only used when lang === 'ar')

    Build a labels object:
    ```tsx
    const labels = {
      fr: {
        title: 'RAPPORT Z',
        store: 'Magasin', terminal: 'Terminal', openedBy: 'Ouvert par', closedBy: 'Cloture par',
        from: 'Du', to: 'Au', salesSummary: 'Resume des Ventes',
        totalOrders: 'Nombre de tickets', completedOrders: 'Tickets completes', returnedOrders: 'Retours',
        grossRevenue: 'Chiffre d\'affaires brut', discounts: 'Remises', netRevenue: 'Chiffre d\'affaires net',
        averageBasket: 'Panier moyen', paymentBreakdown: 'Ventilation par Mode de Paiement',
        paymentType: 'Mode', category: 'Type', amount: 'Montant',
        cashReconciliation: 'Reconciliation de Caisse',
        openingBalance: 'Fond d\'ouverture', cashReceived: 'Especes recues',
        cashAdded: 'Ajouts', cashWithdrawn: 'Retraits', expenses: 'Depenses',
        expectedCash: 'Especes attendues', countedCash: 'Especes comptees', variance: 'Ecart',
        denominations: 'Comptage des Coupures', denomination: 'Coupure', count: 'Nombre', total: 'Total',
        signature: 'Signature du gerant', generatedAt: 'Genere le',
        reportNumber: 'Rapport Z N',
      },
      ar: {
        title: 'تقرير Z',
        store: 'المتجر', terminal: 'الطرفية', openedBy: 'فتح من طرف', closedBy: 'أغلق من طرف',
        from: 'من', to: 'إلى', salesSummary: 'ملخص المبيعات',
        totalOrders: 'عدد التذاكر', completedOrders: 'التذاكر المكتملة', returnedOrders: 'المرتجعات',
        grossRevenue: 'الإيرادات الإجمالية', discounts: 'الخصومات', netRevenue: 'صافي الإيرادات',
        averageBasket: 'متوسط السلة', paymentBreakdown: 'توزيع طرق الدفع',
        paymentType: 'الطريقة', category: 'النوع', amount: 'المبلغ',
        cashReconciliation: 'تسوية الصندوق',
        openingBalance: 'رصيد الافتتاح', cashReceived: 'النقد المستلم',
        cashAdded: 'إضافات', cashWithdrawn: 'سحوبات', expenses: 'مصاريف',
        expectedCash: 'النقد المتوقع', countedCash: 'النقد المحسوب', variance: 'الفرق',
        denominations: 'عد الأوراق النقدية', denomination: 'الفئة', count: 'العدد', total: 'المجموع',
        signature: 'توقيع المدير', generatedAt: 'تم الإنشاء في',
        reportNumber: 'تقرير Z رقم',
      },
    };
    ```

    The Document renders these sections in order:
    1. **Header**: Store name, terminal code, report number (`Z-{zReportNumber}`), date range (dateFrom to dateTo), openedBy/closedBy.
    2. **Sales Summary**: Table rows for totalOrders, completedOrders, returnedOrders, grossRevenue, discounts, netRevenue, averageBasket.
    3. **Payment Breakdown**: Table with columns: payment name, category, amount. Footer row with total.
    4. **Cash Reconciliation**: Table rows for openingBalance, cashReceived, cashAdded, cashWithdrawn, expenses, expectedCash, countedCash, variance. Highlight variance in red if negative.
    5. **Denomination Count**: Table with columns: denomination value, count, total (value * count). Only show if denominations array is non-empty.
    6. **Signature Block**: Line for manager signature with name and date.
    7. **Footer**: Generated at timestamp and report number.

    For Arabic lang: apply `arabicPage` style to Page, wrap all label text with `rtl()`, use `arabicText` style on all Text elements.

    Format currency values with `new Intl.NumberFormat('fr-FR', { minimumFractionDigits: 2 }).format(value) + ' MRU'`.
    Format dates with luxon: `DateTime.fromISO(dateStr).toFormat('dd/MM/yyyy HH:mm')`.

    Export `ZReportDocument` as the default export.

    **D. Build z-report-page.tsx:**

    Create `front/src/app-admin/containers/closing/z-report-page.tsx`:

    This admin page:
    1. Uses `DashboardLayout` with breadcrumbs: Home > Reports > Z-Reports.
    2. Fetches closed sessions using the existing closing list endpoint (filter by closedAt IS NOT NULL, or just show the list and indicate which are closed).
    3. For simplicity, call `GET /admin/closing/list` and filter client-side to show only sessions where `closedAt` is set and `zReportSnapshot` is available (the ClosingDto now includes zReportNumber).
    4. Display a table with columns: Z-Report #, Terminal, Store, Date Range, Closed By, Actions.
    5. The Actions column has two buttons:
       - "PDF FR" button: fetches the snapshot via `GET /admin/closing/{id}/z-report-data`, then uses `pdf(<ZReportDocument data={snapshot} lang="fr" />).toBlob()` to generate and download the PDF.
       - "PDF AR" button: same but with `lang="ar"`.
    6. Use a helper function for download:
       ```tsx
       const downloadPdf = async (closingId: string, lang: 'fr' | 'ar') => {
         const res = await jsonRequest(CLOSING_ZREPORT_DATA.replace(':id', closingId));
         const snapshot = await res.json();
         const blob = await pdf(<ZReportDocument data={snapshot} lang={lang} />).toBlob();
         const url = URL.createObjectURL(blob);
         const a = document.createElement('a');
         a.href = url;
         a.download = `z-report-${snapshot.zReportNumber}-${lang}.pdf`;
         a.click();
         URL.revokeObjectURL(url);
       };
       ```

    **E. Add denomination inputs to sale.closing.tsx (ZRPT-05):**

    In `front/src/app-frontend/components/sale/sale.closing.tsx`, add a denomination counting section to the closing form. This appears ONLY when the session is being closed (when `closing?.openingBalance !== null`), placed between the "Cash withdrawn" row and the payment rows.

    Define MRU denominations: `const MRU_DENOMINATIONS = [500, 200, 100, 50, 20, 10, 5, 1] as const;`

    Add a section header row "Denomination Count" then for each denomination value, render:
    ```tsx
    <tr key={denom}>
      <th className="text-right">{denom} MRU</th>
      <td>
        <Input
          {...register(`denominations.${denom}`, { valueAsNumber: true })}
          type="number"
          min={0}
          className="w-full"
          defaultValue={0}
        />
      </td>
    </tr>
    ```

    Also add a computed "Denomination Total" row that sums `denom * count` for all denominations and displays the total.

    **CRITICAL**: Modify the `onSubmit` handler. When closing the day (not updateOnly), instead of using the existing `CLOSING_EDIT` endpoint, call the NEW `CLOSING_CLOSE` endpoint (POST `/admin/closing/{id}/close`). The request body should include:
    - `closingBalance`: the denomination total (or the manually entered counted cash)
    - `denominations`: an array of `{value, count, total}` objects built from the form inputs

    The denomination total becomes the `closingBalance`. Expected cash is still computed client-side as `cashInHand` for display, but the actual comparison happens in the snapshot on the backend.

    **F. Update routing and navigation:**

    1. In `front/src/api/routing/routes/backend.app.ts`, add:
       ```ts
       export const CLOSING_CLOSE = scopeUrl('/admin/closing/:id/close');
       export const CLOSING_ZREPORT_DATA = scopeUrl('/admin/closing/:id/z-report-data');
       export const REPORT_VENDOR = scopeUrl('/admin/report/vendor');
       export const REPORT_CATEGORY = scopeUrl('/admin/report/category');
       ```

    2. In `front/src/app-admin/routes/frontend.routes.ts`, add:
       ```ts
       export const REPORTS_VENDOR = staticRoute('/reports/vendor');
       export const REPORTS_CATEGORY = staticRoute('/reports/category');
       export const Z_REPORTS = staticRoute('/reports/z-reports');
       ```

    3. In `front/src/app-admin/app.tsx`:
       - Import the new pages: `ZReportPage`, `VendorReport`, `CategoryReport`
       - Import the new route constants: `REPORTS_VENDOR`, `REPORTS_CATEGORY`, `Z_REPORTS`
       - Add Route entries (inside RequireAuth + RequireRole ROLE_MANAGER):
         ```tsx
         <Route path={REPORTS_VENDOR} element={<RequireAuth><RequireRole role="ROLE_MANAGER"><VendorReport/></RequireRole></RequireAuth>}/>
         <Route path={REPORTS_CATEGORY} element={<RequireAuth><RequireRole role="ROLE_MANAGER"><CategoryReport/></RequireRole></RequireAuth>}/>
         <Route path={Z_REPORTS} element={<RequireAuth><RequireRole role="ROLE_MANAGER"><ZReportPage/></RequireRole></RequireAuth>}/>
         ```

    4. In `front/src/app-admin/containers/layout/sidebar.tsx`:
       - Import `REPORTS_VENDOR`, `REPORTS_CATEGORY`, `Z_REPORTS`
       - Add sidebar links in the Reports section:
         - "Vendor Report" linking to REPORTS_VENDOR with icon `bi-person-badge`
         - "Category Report" linking to REPORTS_CATEGORY with icon `bi-tags`
         - "Z-Reports" linking to Z_REPORTS with icon `bi-file-earmark-pdf`

    5. Update `front/src/api/model/closing.ts` to add:
       ```ts
       zReportNumber?: number;
       zReportSnapshot?: any;
       ```
  </action>
  <verify>
    1. Run `cd /Users/abdellahi/Documents/POS/Pointe_de_Vente/front && npm run build` (or `npx tsc --noEmit`) to verify TypeScript compilation succeeds with no errors.
    2. Verify the new routes exist: search for `REPORTS_VENDOR`, `REPORTS_CATEGORY`, `Z_REPORTS` in app.tsx.
    3. Verify ZReportDocument.tsx imports @react-pdf/renderer successfully.
    4. Verify sale.closing.tsx has denomination inputs for all 8 MRU values (500, 200, 100, 50, 20, 10, 5, 1).
  </verify>
  <done>ZReportDocument.tsx renders a complete Z-Report PDF in both French and Arabic with all required sections. Z-Report list page allows downloading FR and AR PDFs. POS closing modal includes denomination count inputs for 8 MRU bill values. Closing the day now calls the new close endpoint with denominations.</done>
</task>

<task type="auto">
  <name>Task 2: Vendor report, category report, and enhanced daily/profit report pages</name>
  <files>
    front/src/app-admin/containers/reports/vendor-report.tsx
    front/src/app-admin/containers/reports/category-report.tsx
    front/src/app-admin/containers/reports/daily-report.tsx
    front/src/app-admin/containers/reports/profit-report.tsx
  </files>
  <action>
    **A. Create vendor-report.tsx** (follows exact pattern of sales-report.tsx):

    `front/src/app-admin/containers/reports/vendor-report.tsx`:

    1. Interface `VendorData`:
       ```ts
       interface VendorData {
         dateFrom: string;
         dateTo: string;
         vendors: Array<{
           vendorId: number;
           vendorName: string;
           totalOrders: number;
           grossRevenue: number;
           totalDiscounts: number;
           netRevenue: number;
           averageBasket: number;
         }>;
       }
       ```

    2. Component `VendorReport`: Uses `DashboardLayout` with breadcrumbs Home > Reports > Vendor Report.
    3. Date range filter (dateFrom, dateTo) + Apply button — same pattern as sales-report.tsx.
    4. Fetches from `REPORT_VENDOR` with dateFrom/dateTo query params.
    5. Displays a table with columns: #, Vendor, Orders, Gross Revenue, Discounts, Net Revenue, Avg Basket.
    6. Each row shows the vendor data. Footer row with totals.
    7. Format currency with `Intl.NumberFormat` + ` MRU` suffix, same as other reports.

    **B. Create category-report.tsx** (follows same pattern):

    `front/src/app-admin/containers/reports/category-report.tsx`:

    1. Interface `CategoryData`:
       ```ts
       interface CategoryData {
         dateFrom: string;
         dateTo: string;
         categories: Array<{
           categoryId: number;
           categoryName: string;
           totalOrders: number;
           grossRevenue: number;
           totalDiscounts: number;
           netRevenue: number;
           totalCost: number;
           grossProfit: number;
           profitMargin: number;
         }>;
       }
       ```

    2. Component `CategoryReport`: DashboardLayout with breadcrumbs Home > Reports > Category Report.
    3. Same date filter pattern.
    4. Fetches from `REPORT_CATEGORY`.
    5. Table with columns: #, Category, Orders, Gross Revenue, Cost, Profit, Margin %.
    6. Color margin positive green, negative red.
    7. Footer row with totals (margin computed on aggregated totals).

    **C. Enhance daily-report.tsx (RAPT-03):**

    Update `front/src/app-admin/containers/reports/daily-report.tsx`:

    1. Update the `DailyData` interface to add:
       ```ts
       averageBasket: number;
       topVendors: Array<{ vendorName: string; totalOrders: string; revenue: string }>;
       yesterday: {
         date: string;
         grossRevenue: number;
         netRevenue: number;
         totalOrders: number;
       };
       ```

    2. Add an "Average Basket" KPI card after the existing Profit Margin card.

    3. Add a "Yesterday Comparison" card (or row). Show yesterday's netRevenue and totalOrders alongside today's, with a delta:
       ```tsx
       <div className="col-md-6">
         <div className="card">
           <div className="card-body">
             <h5 className="card-title">{t('Comparison J-1')}</h5>
             <table className="table">
               <thead><tr><th></th><th>{t('Today')}</th><th>{t('Yesterday')}</th><th>{t('Change')}</th></tr></thead>
               <tbody>
                 <tr>
                   <td>{t('Net Revenue')}</td>
                   <td>{formatCurrency(data.netRevenue)}</td>
                   <td>{formatCurrency(data.yesterday.netRevenue)}</td>
                   <td className={delta >= 0 ? 'text-success' : 'text-danger'}>
                     {delta >= 0 ? '+' : ''}{delta.toFixed(1)}%
                   </td>
                 </tr>
                 // Same for totalOrders
               </tbody>
             </table>
           </div>
         </div>
       </div>
       ```
       Compute delta: `((today - yesterday) / Math.max(yesterday, 1)) * 100`.

    4. Add a "Top Vendors" table section alongside the existing "Top Products" section. Use the same col-md-6 grid layout. Display vendorName, totalOrders, revenue.

    **D. Enhance profit-report.tsx (RAPT-02):**

    Update `front/src/app-admin/containers/reports/profit-report.tsx`:

    1. Add `margin` to the `topProducts` interface:
       ```ts
       topProducts: Array<{
         productName: string;
         totalQty: string;
         revenue: string;
         cost: string;
         profit: string;
         margin: number; // NEW
       }>;
       ```

    2. Add a "Margin %" column to the top products table, after the Profit column:
       ```tsx
       <th className="text-end">{t('Margin')} %</th>
       // In body:
       <td className={`text-end ${Number(p.margin) >= 0 ? 'text-success' : 'text-danger'}`}>
         {Number(p.margin).toFixed(1)}%
       </td>
       ```

    Ensure all new pages use `useTranslation()` for i18n keys. Use the same `formatCurrency` helper pattern as existing reports.
  </action>
  <verify>
    1. Run `cd /Users/abdellahi/Documents/POS/Pointe_de_Vente/front && npm run build` (or `npx tsc --noEmit`) to verify TypeScript compilation.
    2. Verify vendor-report.tsx and category-report.tsx export their components.
    3. Verify daily-report.tsx includes `topVendors` and `yesterday` rendering.
    4. Verify profit-report.tsx includes `margin` column in the table.
  </verify>
  <done>Vendor and category report pages display analytics from the new backend endpoints. Daily report shows top vendors, J-1 comparison with delta percentage, and average basket. Profit report shows margin % per product. All pages use consistent layout, currency formatting, and i18n patterns.</done>
</task>

</tasks>

<verification>
1. Z-Report PDF downloads correctly in French with all sections (header, sales, payments, cash reconciliation, denominations, signature)
2. Z-Report PDF downloads correctly in Arabic with RTL layout
3. POS closing modal shows denomination count fields for all 8 MRU values (500, 200, 100, 50, 20, 10, 5, 1)
4. Closing the day calls the new /close endpoint and stores denominations
5. Z-Report list page shows closed sessions with FR and AR download buttons
6. Vendor report page shows per-vendeur breakdown with average basket
7. Category report page shows per-category breakdown with profit margin
8. Daily report shows top vendors and J-1 comparison
9. Profit report shows margin % per product
10. All new pages are accessible from the sidebar and protected by ROLE_MANAGER
11. Frontend compiles with no TypeScript errors
</verification>

<success_criteria>
- Z-Report PDF renders correctly in both French and Arabic (Arabic uses Noto Sans Arabic font with RTL direction)
- The PDF includes all required Z-Report sections per ZRPT-03/04/05 spec
- Two separate PDF downloads (FR button, AR button) per research recommendation
- Denomination inputs capture MRU bill counts during POS session close
- Vendor, category report pages display data from new backend endpoints
- Daily report enhanced with top vendors and J-1 comparison
- Profit report shows per-product margin percentage using costAtSale
- All pages gated by ROLE_MANAGER via RequireRole
</success_criteria>

<output>
After completion, create `.planning/phases/05-z-report-and-extended-reports/05-03-SUMMARY.md`
</output>
